<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°Mermaidæ¸²æŸ“å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-input {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .test-output {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background: #f9f9f9;
            min-height: 300px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .example-btn {
            background: #28a745;
        }
        .example-btn:hover {
            background: #1e7e34;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æœ¬åœ°Mermaidæ¸²æŸ“å™¨æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æœ¬åœ°Mermaidæ¸²æŸ“å™¨ï¼ŒéªŒè¯CSPä¿®å¤æ˜¯å¦æˆåŠŸã€‚</p>
        
        <h2>æµ‹è¯•è¾“å…¥</h2>
        <textarea id="mermaidInput" class="test-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥Mermaidä»£ç ...">flowchart TD
    A[å¼€å§‹] --> B[è·å–ç”¨æˆ·è¾“å…¥]
    B --> C{è¾“å…¥æœ‰æ•ˆ?}
    C -->|æ˜¯| D[å¤„ç†æ•°æ®]
    C -->|å¦| E[æ˜¾ç¤ºé”™è¯¯]
    D --> F[ä¿å­˜ç»“æœ]
    E --> G[é‡æ–°è¾“å…¥]
    F --> H[ç»“æŸ]
    G --> B</textarea>
        
        <div>
            <button class="btn" onclick="renderTest()">ğŸ¨ æ¸²æŸ“æµ‹è¯•</button>
            <button class="btn example-btn" onclick="loadExample1()">ğŸ“ ç¤ºä¾‹1: ç”¨æˆ·æ³¨å†Œ</button>
            <button class="btn example-btn" onclick="loadExample2()">ğŸ›’ ç¤ºä¾‹2: è®¢å•å¤„ç†</button>
            <button class="btn example-btn" onclick="loadExample3()">ğŸ”„ ç¤ºä¾‹3: æ•°æ®åŒæ­¥</button>
        </div>
        
        <h2>æ¸²æŸ“ç»“æœ</h2>
        <div id="testOutput" class="test-output">
            <p style="color: #666; text-align: center; margin-top: 100px;">ç‚¹å‡»"æ¸²æŸ“æµ‹è¯•"æŒ‰é’®æŸ¥çœ‹ç»“æœ</p>
        </div>
        
        <h2>æµ‹è¯•ä¿¡æ¯</h2>
        <div id="testInfo" style="background: #e9ecef; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px;">
            ç­‰å¾…æµ‹è¯•...
        </div>
    </div>

    <!-- åŠ è½½æœ¬åœ°æ¸²æŸ“å™¨ -->
    <script src="lib/mermaid-renderer.js"></script>
    
    <script>
        function renderTest() {
            const input = document.getElementById('mermaidInput').value;
            const output = document.getElementById('testOutput');
            const info = document.getElementById('testInfo');
            
            const startTime = performance.now();
            
            try {
                info.innerHTML = 'å¼€å§‹æ¸²æŸ“æµ‹è¯•...<br>';
                
                // æ£€æŸ¥æ¸²æŸ“å™¨æ˜¯å¦åŠ è½½
                if (typeof window.renderMermaidLocally !== 'function') {
                    throw new Error('æœ¬åœ°æ¸²æŸ“å™¨æœªåŠ è½½');
                }
                
                info.innerHTML += 'æ¸²æŸ“å™¨å·²åŠ è½½ âœ…<br>';
                
                // æ¸²æŸ“Mermaidä»£ç 
                const svg = window.renderMermaidLocally(input);
                
                const endTime = performance.now();
                const renderTime = (endTime - startTime).toFixed(2);
                
                // æ˜¾ç¤ºç»“æœ
                output.innerHTML = svg;
                
                info.innerHTML += `æ¸²æŸ“å®Œæˆ âœ…<br>`;
                info.innerHTML += `æ¸²æŸ“æ—¶é—´: ${renderTime}ms<br>`;
                info.innerHTML += `SVGé•¿åº¦: ${svg.length} å­—ç¬¦<br>`;
                info.innerHTML += `è¾“å…¥è¡Œæ•°: ${input.split('\\n').length}<br>`;
                
                // æ£€æŸ¥SVGæ˜¯å¦æœ‰æ•ˆ
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svg, 'image/svg+xml');
                const parseError = svgDoc.querySelector('parsererror');
                
                if (parseError) {
                    info.innerHTML += `SVGè§£æé”™è¯¯ âŒ<br>`;
                } else {
                    info.innerHTML += `SVGæ ¼å¼æœ‰æ•ˆ âœ…<br>`;
                }
                
            } catch (error) {
                output.innerHTML = `<div style="color: red; padding: 20px;">
                    <h3>æ¸²æŸ“å¤±è´¥</h3>
                    <p>é”™è¯¯: ${error.message}</p>
                    <p>è¯·æ£€æŸ¥Mermaidä»£ç æ ¼å¼æˆ–æ¸²æŸ“å™¨åŠ è½½çŠ¶æ€ã€‚</p>
                </div>`;
                
                info.innerHTML += `æ¸²æŸ“å¤±è´¥ âŒ<br>é”™è¯¯: ${error.message}<br>`;
            }
        }
        
        function loadExample1() {
            document.getElementById('mermaidInput').value = `flowchart TD
    A[ç”¨æˆ·è®¿é—®æ³¨å†Œé¡µ] --> B[å¡«å†™æ³¨å†Œè¡¨å•]
    B --> C{è¡¨å•éªŒè¯}
    C -->|é€šè¿‡| D[åˆ›å»ºç”¨æˆ·è´¦æˆ·]
    C -->|å¤±è´¥| E[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    D --> F[å‘é€éªŒè¯é‚®ä»¶]
    E --> B
    F --> G[ç”¨æˆ·ç‚¹å‡»éªŒè¯é“¾æ¥]
    G --> H{é“¾æ¥æœ‰æ•ˆ?}
    H -->|æ˜¯| I[æ¿€æ´»è´¦æˆ·]
    H -->|å¦| J[æ˜¾ç¤ºé”™è¯¯é¡µé¢]
    I --> K[æ³¨å†Œå®Œæˆ]
    J --> L[ç»“æŸ]
    K --> L`;
        }
        
        function loadExample2() {
            document.getElementById('mermaidInput').value = `flowchart TD
    A[å®¢æˆ·ä¸‹å•] --> B[åº“å­˜æ£€æŸ¥]
    B --> C{åº“å­˜å……è¶³?}
    C -->|æ˜¯| D[ç”Ÿæˆè®¢å•]
    C -->|å¦| E[é€šçŸ¥ç¼ºè´§]
    D --> F[å¤„ç†æ”¯ä»˜]
    F --> G{æ”¯ä»˜æˆåŠŸ?}
    G -->|æ˜¯| H[ç¡®è®¤è®¢å•]
    G -->|å¦| I[å–æ¶ˆè®¢å•]
    H --> J[å®‰æ’å‘è´§]
    I --> K[é‡Šæ”¾åº“å­˜]
    J --> L[è®¢å•å®Œæˆ]
    K --> L
    E --> L`;
        }
        
        function loadExample3() {
            document.getElementById('mermaidInput').value = `flowchart TD
    A[å¯åŠ¨åŒæ­¥] --> B[è¿æ¥è¿œç¨‹æœåŠ¡å™¨]
    B --> C{è¿æ¥æˆåŠŸ?}
    C -->|æ˜¯| D[è·å–è¿œç¨‹æ•°æ®]
    C -->|å¦| E[é‡è¯•è¿æ¥]
    D --> F[æ¯”è¾ƒæœ¬åœ°æ•°æ®]
    F --> G{éœ€è¦æ›´æ–°?}
    G -->|æ˜¯| H[ä¸‹è½½æ›´æ–°]
    G -->|å¦| I[åŒæ­¥å®Œæˆ]
    H --> J{ä¸‹è½½æˆåŠŸ?}
    J -->|æ˜¯| K[åº”ç”¨æ›´æ–°]
    J -->|å¦| L[è®°å½•é”™è¯¯]
    K --> I
    L --> M[åŒæ­¥å¤±è´¥]
    E --> N{é‡è¯•æ¬¡æ•°<3?}
    N -->|æ˜¯| B
    N -->|å¦| M`;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œç¬¬ä¸€ä¸ªç¤ºä¾‹
        window.addEventListener('load', function() {
            loadExample1();
            setTimeout(renderTest, 500);
        });
    </script>
</body>
</html>
